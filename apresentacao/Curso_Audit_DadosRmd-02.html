<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Flávio Brito" />

<meta name="date" content="2016-12-10" />

<title>Curso Auditoria de Dados - Estudo de Caso</title>

<script src="Curso_Audit_DadosRmd-02_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Curso_Audit_DadosRmd-02_files/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="Curso_Audit_DadosRmd-02_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Curso_Audit_DadosRmd-02_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Curso_Audit_DadosRmd-02_files/bootstrap-3.3.5/shim/respond.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="Curso_Audit_DadosRmd-02_files/navigation-1.0/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">


<h1 class="title">Curso Auditoria de Dados - Estudo de Caso</h1>
<h4 class="author"><em>Flávio Brito</em></h4>
<h4 class="date"><em>23/10/2016</em></h4>

</div>

<div id="TOC">
<ul>
<li><a href="#arquivos"><span class="toc-section-number">1</span> Arquivos</a></li>
<li><a href="#arquivo-e-sua-estrutura"><span class="toc-section-number">2</span> Arquivo e sua Estrutura</a></li>
<li><a href="#limpando-fomatacoes"><span class="toc-section-number">3</span> Limpando fomatações</a><ul>
<li><a href="#limpa-cnpj"><span class="toc-section-number">3.1</span> Limpa CNPJ</a></li>
<li><a href="#limpa-caracteres-especiais-do-campo-valor"><span class="toc-section-number">3.2</span> Limpa caracteres especiais do campo Valor</a></li>
</ul></li>
<li><a href="#tratamento-para-o-campo-data"><span class="toc-section-number">4</span> Tratamento para o campo Data</a></li>
<li><a href="#verifica-quais-cnpj-aparecem-mais-de-uma-vez"><span class="toc-section-number">5</span> Verifica quais CNPJ aparecem mais de uma vez</a></li>
<li><a href="#quais-os-cnpj-que-nao-aparecem-repetidamente"><span class="toc-section-number">6</span> Quais os CNPJ que não aparecem repetidamente</a></li>
<li><a href="#testes-de-consistencia"><span class="toc-section-number">7</span> Testes de Consistência</a><ul>
<li><a href="#registros-duplicados"><span class="toc-section-number">7.1</span> Registros duplicados</a></li>
</ul></li>
<li><a href="#agregacao"><span class="toc-section-number">8</span> Agregação</a><ul>
<li><a href="#agrupando-usando-sql-em-data-frames"><span class="toc-section-number">8.1</span> Agrupando usando SQL em Data Frames</a></li>
<li><a href="#somar-dos-valores-agrupados-por-cnpj---xtabs"><span class="toc-section-number">8.2</span> Somar dos Valores agrupados por CNPJ - (xtabs)</a></li>
</ul></li>
<li><a href="#teste-de-sequencias"><span class="toc-section-number">9</span> Teste de sequencias</a><ul>
<li><a href="#ordenacao-de-registros"><span class="toc-section-number">9.1</span> Ordenação de registros</a><ul>
<li><a href="#sintaxe-sql"><span class="toc-section-number">9.1.1</span> Sintaxe SQL</a></li>
<li><a href="#sintaxe-vetorial"><span class="toc-section-number">9.1.2</span> Sintaxe Vetorial</a></li>
</ul></li>
</ul></li>
<li><a href="#resumo-do-data-frame"><span class="toc-section-number">10</span> Resumo do Data Frame</a></li>
<li><a href="#aprofundando-nos-testes-de-possiveis-fraudes"><span class="toc-section-number">11</span> Aprofundando nos Testes de Possíveis Fraudes</a></li>
</ul>
</div>

<div id="arquivos" class="section level1">
<h1><span class="header-section-number">1</span> Arquivos</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Retirando um data frame da memória</span>
nf &lt;-<span class="st"> </span><span class="ot">NULL</span>

<span class="co">#Lendo o arquivo no padrão csv com separador ; e criando o data frame nf</span>
nf &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file=</span><span class="st">&quot;~/Documents/NotaFiscal.csv&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;;&quot;</span>,<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>,<span class="dt">na.strings=</span><span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot; &quot;</span>) )</code></pre></div>
</div>
<div id="arquivo-e-sua-estrutura" class="section level1">
<h1><span class="header-section-number">2</span> Arquivo e sua Estrutura</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Arquivo</span>
<span class="kw">print</span>(nf)</code></pre></div>
<pre><code>##                  CNPJ UF       Data      NF Classificacao            Valor
## 1  21.704.783/0001-64 RJ 01/09/2016      90            ME     R$30.000,00 
## 2  21.704.783/0001-64 RJ 02/09/2016      91            ME     R$40.000,00 
## 3  03.117.734/0001-43 SP 03/09/2016    2000           MEI        R$444,00 
## 4  76.313.316/0001-03 SP 04/09/2016     111           MEI          R$4,00 
## 5  06.062.510/0001-70 SP 05/09/2016     222          &lt;NA&gt;      R$4.444,00 
## 6  16.474.789/0001-52 GO 06/09/2016   33333          &lt;NA&gt;         R$55,00 
## 7  84.846.156/0001-88 GO 07/09/2016 4444444           MEI        R$667,00 
## 8  49.740.886/0001-07 MA 08/09/2016     555            SA        R$666,00 
## 9  49.740.886/0001-07 MA 09/09/2016     400          &lt;NA&gt;      R$7.777,00 
## 10 21.704.783/0001-64 ES 10/09/2016      89           MEI  R$8.888.888,00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Quantas linhas?</span>
<span class="kw">nrow</span>(nf)</code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Quantas colunas?</span>
<span class="kw">ncol</span>(nf)</code></pre></div>
<pre><code>## [1] 6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Qual a dimensão do data frame?</span>
<span class="kw">dim</span>(nf)</code></pre></div>
<pre><code>## [1] 10  6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Estrutura</span>
<span class="kw">str</span>(nf)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    10 obs. of  6 variables:
##  $ CNPJ         : chr  &quot;21.704.783/0001-64&quot; &quot;21.704.783/0001-64&quot; &quot;03.117.734/0001-43&quot; &quot;76.313.316/0001-03&quot; ...
##  $ UF           : chr  &quot;RJ&quot; &quot;RJ&quot; &quot;SP&quot; &quot;SP&quot; ...
##  $ Data         : chr  &quot;01/09/2016&quot; &quot;02/09/2016&quot; &quot;03/09/2016&quot; &quot;04/09/2016&quot; ...
##  $ NF           : int  90 91 2000 111 222 33333 4444444 555 400 89
##  $ Classificacao: chr  &quot;ME&quot; &quot;ME&quot; &quot;MEI&quot; &quot;MEI&quot; ...
##  $ Valor        : chr  &quot; R$30.000,00 &quot; &quot; R$40.000,00 &quot; &quot; R$444,00 &quot; &quot; R$4,00 &quot; ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Existem NA?</span>
<span class="kw">any</span>(<span class="kw">is.na</span>(nf))</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Removendo NA</span>
nf_sem_NA &lt;-<span class="st"> </span><span class="kw">na.omit</span>(nf)
<span class="kw">print</span>(nf_sem_NA)</code></pre></div>
<pre><code>##                  CNPJ UF       Data      NF Classificacao            Valor
## 1  21.704.783/0001-64 RJ 01/09/2016      90            ME     R$30.000,00 
## 2  21.704.783/0001-64 RJ 02/09/2016      91            ME     R$40.000,00 
## 3  03.117.734/0001-43 SP 03/09/2016    2000           MEI        R$444,00 
## 4  76.313.316/0001-03 SP 04/09/2016     111           MEI          R$4,00 
## 7  84.846.156/0001-88 GO 07/09/2016 4444444           MEI        R$667,00 
## 8  49.740.886/0001-07 MA 08/09/2016     555            SA        R$666,00 
## 10 21.704.783/0001-64 ES 10/09/2016      89           MEI  R$8.888.888,00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">max</span>(nf_sem_NA$Data)</code></pre></div>
<pre><code>## [1] &quot;10/09/2016&quot;</code></pre>
</div>
<div id="limpando-fomatacoes" class="section level1">
<h1><span class="header-section-number">3</span> Limpando fomatações</h1>
<div id="limpa-cnpj" class="section level2">
<h2><span class="header-section-number">3.1</span> Limpa CNPJ</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#nf$CNPJ &lt;- gsub(&quot;[[:punct:]]&quot;,&quot;&quot;,nf$CNPJ)</span>
<span class="kw">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>,<span class="st">&quot;&quot;</span>,nf$CNPJ)</code></pre></div>
<pre><code>##  [1] &quot;21704783000164&quot; &quot;21704783000164&quot; &quot;03117734000143&quot; &quot;76313316000103&quot;
##  [5] &quot;06062510000170&quot; &quot;16474789000152&quot; &quot;84846156000188&quot; &quot;49740886000107&quot;
##  [9] &quot;49740886000107&quot; &quot;21704783000164&quot;</code></pre>
</div>
<div id="limpa-caracteres-especiais-do-campo-valor" class="section level2">
<h2><span class="header-section-number">3.2</span> Limpa caracteres especiais do campo Valor</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Exibe o tipo do atributo antes da mudan?a</span>
<span class="kw">class</span>(nf$Valor)</code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nf$Valor &lt;-<span class="st"> </span><span class="kw">trimws</span>(<span class="kw">gsub</span>(<span class="st">&quot;[R$.]&quot;</span>,<span class="st">&quot;&quot;</span>,nf$Valor))
nf$Valor &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;,&quot;</span>,<span class="st">&quot;.&quot;</span>, nf$Valor))

<span class="co">#Exibe o tipo do atributo ap?s a coer??o</span>
<span class="kw">class</span>(nf$Valor)</code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
</div>
</div>
<div id="tratamento-para-o-campo-data" class="section level1">
<h1><span class="header-section-number">4</span> Tratamento para o campo Data</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lubridate)
nf$Data &lt;-<span class="kw">dmy</span>(nf$Data)
nf$Data</code></pre></div>
<pre><code>##  [1] &quot;2016-09-01 UTC&quot; &quot;2016-09-02 UTC&quot; &quot;2016-09-03 UTC&quot; &quot;2016-09-04 UTC&quot;
##  [5] &quot;2016-09-05 UTC&quot; &quot;2016-09-06 UTC&quot; &quot;2016-09-07 UTC&quot; &quot;2016-09-08 UTC&quot;
##  [9] &quot;2016-09-09 UTC&quot; &quot;2016-09-10 UTC&quot;</code></pre>
</div>
<div id="verifica-quais-cnpj-aparecem-mais-de-uma-vez" class="section level1">
<h1><span class="header-section-number">5</span> Verifica quais CNPJ aparecem mais de uma vez</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nf[<span class="kw">duplicated</span>(nf$CNPJ),] <span class="co">#(Repare bem nos valores!!!)</span></code></pre></div>
<pre><code>##                  CNPJ UF       Data  NF Classificacao   Valor
## 2  21.704.783/0001-64 RJ 2016-09-02  91            ME   40000
## 9  49.740.886/0001-07 MA 2016-09-09 400          &lt;NA&gt;    7777
## 10 21.704.783/0001-64 ES 2016-09-10  89           MEI 8888888</code></pre>
</div>
<div id="quais-os-cnpj-que-nao-aparecem-repetidamente" class="section level1">
<h1><span class="header-section-number">6</span> Quais os CNPJ que não aparecem repetidamente</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nf[!<span class="kw">duplicated</span>(nf$CNPJ),]</code></pre></div>
<pre><code>##                 CNPJ UF       Data      NF Classificacao Valor
## 1 21.704.783/0001-64 RJ 2016-09-01      90            ME 30000
## 3 03.117.734/0001-43 SP 2016-09-03    2000           MEI   444
## 4 76.313.316/0001-03 SP 2016-09-04     111           MEI     4
## 5 06.062.510/0001-70 SP 2016-09-05     222          &lt;NA&gt;  4444
## 6 16.474.789/0001-52 GO 2016-09-06   33333          &lt;NA&gt;    55
## 7 84.846.156/0001-88 GO 2016-09-07 4444444           MEI   667
## 8 49.740.886/0001-07 MA 2016-09-08     555            SA   666</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unique</span>(nf$CNPJ)</code></pre></div>
<pre><code>## [1] &quot;21.704.783/0001-64&quot; &quot;03.117.734/0001-43&quot; &quot;76.313.316/0001-03&quot;
## [4] &quot;06.062.510/0001-70&quot; &quot;16.474.789/0001-52&quot; &quot;84.846.156/0001-88&quot;
## [7] &quot;49.740.886/0001-07&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nf$CNPJ</code></pre></div>
<pre><code>##  [1] &quot;21.704.783/0001-64&quot; &quot;21.704.783/0001-64&quot; &quot;03.117.734/0001-43&quot;
##  [4] &quot;76.313.316/0001-03&quot; &quot;06.062.510/0001-70&quot; &quot;16.474.789/0001-52&quot;
##  [7] &quot;84.846.156/0001-88&quot; &quot;49.740.886/0001-07&quot; &quot;49.740.886/0001-07&quot;
## [10] &quot;21.704.783/0001-64&quot;</code></pre>
</div>
<div id="testes-de-consistencia" class="section level1">
<h1><span class="header-section-number">7</span> Testes de Consistência</h1>
<div id="registros-duplicados" class="section level2">
<h2><span class="header-section-number">7.1</span> Registros duplicados</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sqldf)</code></pre></div>
<pre><code>## Loading required package: gsubfn</code></pre>
<pre><code>## Loading required package: proto</code></pre>
<pre><code>## Loading required package: RSQLite</code></pre>
<pre><code>## Loading required package: DBI</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sqldf</span>(<span class="st">&quot;select * from nf group by CNPJ having count(*) &gt;1&quot;</span>)</code></pre></div>
<pre><code>## Loading required package: tcltk</code></pre>
<pre><code>##                 CNPJ UF                Data  NF Classificacao   Valor
## 1 21.704.783/0001-64 ES 2016-09-09 21:00:00  89           MEI 8888888
## 2 49.740.886/0001-07 MA 2016-09-08 21:00:00 400          &lt;NA&gt;    7777</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sqldf</span>(<span class="st">&quot;select * from nf group by CNPJ, Classificacao having count(*) &gt;1&quot;</span>)</code></pre></div>
<pre><code>##                 CNPJ UF                Data NF Classificacao Valor
## 1 21.704.783/0001-64 RJ 2016-09-01 21:00:00 91            ME 40000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sqldf</span>(<span class="st">&quot;select * from nf group by CNPJ having count(*) = 1&quot;</span>)</code></pre></div>
<pre><code>##                 CNPJ UF                Data      NF Classificacao Valor
## 1 03.117.734/0001-43 SP 2016-09-02 21:00:00    2000           MEI   444
## 2 06.062.510/0001-70 SP 2016-09-04 21:00:00     222          &lt;NA&gt;  4444
## 3 16.474.789/0001-52 GO 2016-09-05 21:00:00   33333          &lt;NA&gt;    55
## 4 76.313.316/0001-03 SP 2016-09-03 21:00:00     111           MEI     4
## 5 84.846.156/0001-88 GO 2016-09-06 21:00:00 4444444           MEI   667</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nf[<span class="kw">duplicated</span>(nf[<span class="dv">1</span>]),]</code></pre></div>
<pre><code>##                  CNPJ UF       Data  NF Classificacao   Valor
## 2  21.704.783/0001-64 RJ 2016-09-02  91            ME   40000
## 9  49.740.886/0001-07 MA 2016-09-09 400          &lt;NA&gt;    7777
## 10 21.704.783/0001-64 ES 2016-09-10  89           MEI 8888888</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nf[<span class="kw">duplicated</span>(nf[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)]),]</code></pre></div>
<pre><code>##                 CNPJ UF       Data NF Classificacao Valor
## 2 21.704.783/0001-64 RJ 2016-09-02 91            ME 40000</code></pre>
</div>
</div>
<div id="agregacao" class="section level1">
<h1><span class="header-section-number">8</span> Agregação</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Soma dos Valores das NF por CNPJ
<span class="kw">aggregate</span>(Valor~CNPJ, nf, sum)</code></pre></div>
<pre><code>##                 CNPJ   Valor
## 1 03.117.734/0001-43     444
## 2 06.062.510/0001-70    4444
## 3 16.474.789/0001-52      55
## 4 21.704.783/0001-64 8958888
## 5 49.740.886/0001-07    8443
## 6 76.313.316/0001-03       4
## 7 84.846.156/0001-88     667</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Soma dos Valores das NF por CNPJ e Data
<span class="kw">aggregate</span>(Valor~CNPJ +<span class="st"> </span>Data, nf, sum)</code></pre></div>
<pre><code>##                  CNPJ       Data   Valor
## 1  21.704.783/0001-64 2016-09-01   30000
## 2  21.704.783/0001-64 2016-09-02   40000
## 3  03.117.734/0001-43 2016-09-03     444
## 4  76.313.316/0001-03 2016-09-04       4
## 5  06.062.510/0001-70 2016-09-05    4444
## 6  16.474.789/0001-52 2016-09-06      55
## 7  84.846.156/0001-88 2016-09-07     667
## 8  49.740.886/0001-07 2016-09-08     666
## 9  49.740.886/0001-07 2016-09-09    7777
## 10 21.704.783/0001-64 2016-09-10 8888888</code></pre>
<div id="agrupando-usando-sql-em-data-frames" class="section level2">
<h2><span class="header-section-number">8.1</span> Agrupando usando SQL em Data Frames</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Agrupar por CNPJ</span>
<span class="kw">sqldf</span>(<span class="st">&quot;SELECT CNPJ,SUM(Valor) AS Soma FROM nf GROUP BY CNPJ&quot;</span>)</code></pre></div>
<pre><code>##                 CNPJ    Soma
## 1 03.117.734/0001-43     444
## 2 06.062.510/0001-70    4444
## 3 16.474.789/0001-52      55
## 4 21.704.783/0001-64 8958888
## 5 49.740.886/0001-07    8443
## 6 76.313.316/0001-03       4
## 7 84.846.156/0001-88     667</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sqldf</span>(<span class="st">&quot;SELECT CNPJ,SUM(Valor) AS Soma FROM nf GROUP BY CNPJ LIMIT 5&quot;</span>)</code></pre></div>
<pre><code>##                 CNPJ    Soma
## 1 03.117.734/0001-43     444
## 2 06.062.510/0001-70    4444
## 3 16.474.789/0001-52      55
## 4 21.704.783/0001-64 8958888
## 5 49.740.886/0001-07    8443</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Agrupar por CNPJ e Data</span>
<span class="kw">sqldf</span>(<span class="st">&quot;SELECT CNPJ,SUM(Valor) AS Soma FROM nf GROUP BY CNPJ, Data&quot;</span>)</code></pre></div>
<pre><code>##                  CNPJ    Soma
## 1  03.117.734/0001-43     444
## 2  06.062.510/0001-70    4444
## 3  16.474.789/0001-52      55
## 4  21.704.783/0001-64   30000
## 5  21.704.783/0001-64   40000
## 6  21.704.783/0001-64 8888888
## 7  49.740.886/0001-07     666
## 8  49.740.886/0001-07    7777
## 9  76.313.316/0001-03       4
## 10 84.846.156/0001-88     667</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Agrupar por CNPJ e M?s (extra??o)</span>
<span class="kw">sqldf</span>(<span class="st">&quot;SELECT CNPJ,SUM(Valor) AS Soma FROM nf GROUP BY CNPJ, strftime(&#39;%m&#39;, Data)&quot;</span>)</code></pre></div>
<pre><code>##                 CNPJ    Soma
## 1 03.117.734/0001-43     444
## 2 06.062.510/0001-70    4444
## 3 16.474.789/0001-52      55
## 4 21.704.783/0001-64 8958888
## 5 49.740.886/0001-07    8443
## 6 76.313.316/0001-03       4
## 7 84.846.156/0001-88     667</code></pre>
</div>
<div id="somar-dos-valores-agrupados-por-cnpj---xtabs" class="section level2">
<h2><span class="header-section-number">8.2</span> Somar dos Valores agrupados por CNPJ - (xtabs)</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xtabs</span>(Valor~CNPJ, nf)</code></pre></div>
<pre><code>## CNPJ
## 03.117.734/0001-43 06.062.510/0001-70 16.474.789/0001-52 
##                444               4444                 55 
## 21.704.783/0001-64 49.740.886/0001-07 76.313.316/0001-03 
##            8958888               8443                  4 
## 84.846.156/0001-88 
##                667</code></pre>
</div>
</div>
<div id="teste-de-sequencias" class="section level1">
<h1><span class="header-section-number">9</span> Teste de sequencias</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">na.strings=<span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot; &quot;</span>)
nf[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>:<span class="dv">4</span>)]</code></pre></div>
<pre><code>##                  CNPJ       Data      NF
## 1  21.704.783/0001-64 2016-09-01      90
## 2  21.704.783/0001-64 2016-09-02      91
## 3  03.117.734/0001-43 2016-09-03    2000
## 4  76.313.316/0001-03 2016-09-04     111
## 5  06.062.510/0001-70 2016-09-05     222
## 6  16.474.789/0001-52 2016-09-06   33333
## 7  84.846.156/0001-88 2016-09-07 4444444
## 8  49.740.886/0001-07 2016-09-08     555
## 9  49.740.886/0001-07 2016-09-09     400
## 10 21.704.783/0001-64 2016-09-10      89</code></pre>
<div id="ordenacao-de-registros" class="section level2">
<h2><span class="header-section-number">9.1</span> Ordenação de registros</h2>
<div id="sintaxe-sql" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Sintaxe SQL</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Utilizando a sintaxe de SQL do pacote sqldf</span>
nf_seq &lt;-<span class="kw">sqldf</span>(<span class="st">&quot;SELECT a.*, COUNT(*) count</span>
<span class="st">       FROM nf a, nf b</span>
<span class="st">       WHERE a.CNPJ = b.CNPJ </span>
<span class="st">          AND b.NF &gt;= a.NF </span>
<span class="st">          AND b.Data &gt;= b.Data </span>
<span class="st">       GROUP BY a.Data</span>
<span class="st">      ORDER BY b.CNPJ, b.Data, b.NF&quot;</span>)
<span class="kw">print</span>(nf_seq)</code></pre></div>
<pre><code>##                  CNPJ UF                Data      NF Classificacao   Valor
## 1  03.117.734/0001-43 SP 2016-09-02 21:00:00    2000           MEI     444
## 2  06.062.510/0001-70 SP 2016-09-04 21:00:00     222          &lt;NA&gt;    4444
## 3  16.474.789/0001-52 GO 2016-09-05 21:00:00   33333          &lt;NA&gt;      55
## 4  21.704.783/0001-64 RJ 2016-08-31 21:00:00      90            ME   30000
## 5  21.704.783/0001-64 RJ 2016-09-01 21:00:00      91            ME   40000
## 6  21.704.783/0001-64 ES 2016-09-09 21:00:00      89           MEI 8888888
## 7  49.740.886/0001-07 MA 2016-09-07 21:00:00     555            SA     666
## 8  49.740.886/0001-07 MA 2016-09-08 21:00:00     400          &lt;NA&gt;    7777
## 9  76.313.316/0001-03 SP 2016-09-03 21:00:00     111           MEI       4
## 10 84.846.156/0001-88 GO 2016-09-06 21:00:00 4444444           MEI     667
##    count
## 1      1
## 2      1
## 3      1
## 4      2
## 5      1
## 6      3
## 7      1
## 8      2
## 9      1
## 10     1</code></pre>
</div>
<div id="sintaxe-vetorial" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Sintaxe Vetorial</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Ordena o dataframe por CNPJ e Data</span>
nf[<span class="kw">order</span>(nf[,<span class="dv">1</span>], nf[,<span class="dv">3</span>],nf[,<span class="dv">4</span>]), ]</code></pre></div>
<pre><code>##                  CNPJ UF       Data      NF Classificacao   Valor
## 3  03.117.734/0001-43 SP 2016-09-03    2000           MEI     444
## 5  06.062.510/0001-70 SP 2016-09-05     222          &lt;NA&gt;    4444
## 6  16.474.789/0001-52 GO 2016-09-06   33333          &lt;NA&gt;      55
## 1  21.704.783/0001-64 RJ 2016-09-01      90            ME   30000
## 2  21.704.783/0001-64 RJ 2016-09-02      91            ME   40000
## 10 21.704.783/0001-64 ES 2016-09-10      89           MEI 8888888
## 8  49.740.886/0001-07 MA 2016-09-08     555            SA     666
## 9  49.740.886/0001-07 MA 2016-09-09     400          &lt;NA&gt;    7777
## 4  76.313.316/0001-03 SP 2016-09-04     111           MEI       4
## 7  84.846.156/0001-88 GO 2016-09-07 4444444           MEI     667</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Ordena e seleciona os atributos CNPJ, Data e NF de um determinado contribuinte</span>
nf_valida_seq &lt;-<span class="st"> </span>nf[<span class="kw">order</span>(nf[,<span class="dv">1</span>], nf[,<span class="dv">3</span>],nf[,<span class="dv">4</span>]) &amp;<span class="st"> </span>nf$CNPJ==<span class="st">&quot;21.704.783/0001-64&quot;</span>,] 

<span class="co"># Verifica se as NF estão em sequência</span>
nf_valida_seq</code></pre></div>
<pre><code>##                  CNPJ UF       Data NF Classificacao   Valor
## 1  21.704.783/0001-64 RJ 2016-09-01 90            ME   30000
## 2  21.704.783/0001-64 RJ 2016-09-02 91            ME   40000
## 10 21.704.783/0001-64 ES 2016-09-10 89           MEI 8888888</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Lista a sequência de NF</span>
nf_valida_seq$NF</code></pre></div>
<pre><code>## [1] 90 91 89</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Lista as diferenças entre as NF ordenadas por Data</span>
<span class="kw">diff</span>(nf_valida_seq$NF) </code></pre></div>
<pre><code>## [1]  1 -2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Lista sequência resultante do teste</span>
<span class="kw">diff</span>(nf_valida_seq$NF) &lt;=<span class="dv">0</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Verifica se a soma da diferença é positiva e verdadeira</span>
<span class="kw">sum</span>((<span class="kw">diff</span>(nf_valida_seq$NF) &lt;=<span class="dv">0</span>) ==<span class="st"> </span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Verifica visualmente se as NF estão em sequencia</span>
<span class="kw">barplot</span>(nf_valida_seq$NF, <span class="dt">horiz =</span> <span class="ot">TRUE</span>, <span class="dt">names.arg=</span>nf_valida_seq$NF)</code></pre></div>
<p><img src="Curso_Audit_DadosRmd-02_files/figure-html/unnamed-chunk-14-1.png" title="" alt="" width="960" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Trocando o número da Nota do CNPJ &quot;49.740.886/0001-07&quot; cujo valor é 7777 para 557</span>
nf$NF[nf$CNPJ==<span class="st">&quot;49.740.886/0001-07&quot;</span>]</code></pre></div>
<pre><code>## [1] 555 400</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nf$NF[nf$CNPJ==<span class="st">&quot;49.740.886/0001-07&quot;</span> &amp;<span class="st"> </span>nf$Valor==<span class="st">&quot;7777&quot;</span>] &lt;-<span class="st"> </span><span class="dv">400</span>

nf[<span class="kw">order</span>(nf[,<span class="dv">1</span>], nf[,<span class="dv">3</span>],nf[,<span class="dv">4</span>]) &amp;<span class="st"> </span>nf$CNPJ==<span class="st">&quot;49.740.886/0001-07&quot;</span>,]</code></pre></div>
<pre><code>##                 CNPJ UF       Data  NF Classificacao Valor
## 8 49.740.886/0001-07 MA 2016-09-08 555            SA   666
## 9 49.740.886/0001-07 MA 2016-09-09 400          &lt;NA&gt;  7777</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nf_valida_seq &lt;-<span class="st"> </span>nf[<span class="kw">order</span>(nf[,<span class="dv">1</span>], nf[,<span class="dv">3</span>],nf[,<span class="dv">4</span>]) &amp;<span class="st"> </span>nf$CNPJ==<span class="st">&quot;49.740.886/0001-07&quot;</span>,] 

<span class="co"># Verifica se as NF est?o em sequ?ncia</span>
nf_valida_seq</code></pre></div>
<pre><code>##                 CNPJ UF       Data  NF Classificacao Valor
## 8 49.740.886/0001-07 MA 2016-09-08 555            SA   666
## 9 49.740.886/0001-07 MA 2016-09-09 400          &lt;NA&gt;  7777</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>((<span class="kw">diff</span>(nf_valida_seq$NF) &lt;=<span class="dv">0</span>) ==<span class="st"> </span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Visualização Gráfica</span>
<span class="kw">barplot</span>(nf_valida_seq$NF, <span class="dt">horiz =</span> <span class="ot">TRUE</span>, <span class="dt">names.arg=</span>nf_valida_seq$NF)</code></pre></div>
<p><img src="Curso_Audit_DadosRmd-02_files/figure-html/unnamed-chunk-14-2.png" title="" alt="" width="960" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Trocando o número da Nota do CNPJ &quot;49.740.886/0001-07&quot; cujo valor é 7777 para 557</span>
nf$NF[nf$CNPJ==<span class="st">&quot;49.740.886/0001-07&quot;</span>]</code></pre></div>
<pre><code>## [1] 555 400</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nf$NF[nf$CNPJ==<span class="st">&quot;49.740.886/0001-07&quot;</span> &amp;<span class="st"> </span>nf$Valor==<span class="st">&quot;7777&quot;</span>] &lt;-<span class="st"> </span><span class="dv">557</span>

<span class="co">#Testando novamente a auditoria da sequencia</span>
nf[<span class="kw">order</span>(nf[,<span class="dv">1</span>], nf[,<span class="dv">3</span>],nf[,<span class="dv">4</span>]) &amp;<span class="st"> </span>nf$CNPJ==<span class="st">&quot;49.740.886/0001-07&quot;</span>,]</code></pre></div>
<pre><code>##                 CNPJ UF       Data  NF Classificacao Valor
## 8 49.740.886/0001-07 MA 2016-09-08 555            SA   666
## 9 49.740.886/0001-07 MA 2016-09-09 557          &lt;NA&gt;  7777</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nf_valida_seq &lt;-<span class="st"> </span>nf[<span class="kw">order</span>(nf[,<span class="dv">1</span>], nf[,<span class="dv">3</span>],nf[,<span class="dv">4</span>]) &amp;<span class="st"> </span>nf$CNPJ==<span class="st">&quot;49.740.886/0001-07&quot;</span>,] 
<span class="co"># Verifica se as NF est?o em sequ?ncia</span>
nf_valida_seq</code></pre></div>
<pre><code>##                 CNPJ UF       Data  NF Classificacao Valor
## 8 49.740.886/0001-07 MA 2016-09-08 555            SA   666
## 9 49.740.886/0001-07 MA 2016-09-09 557          &lt;NA&gt;  7777</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>((<span class="kw">diff</span>(nf_valida_seq$NF) &lt;=<span class="dv">0</span>) ==<span class="st"> </span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Visualização Gráfica</span>
<span class="kw">barplot</span>(nf_valida_seq$NF, <span class="dt">horiz =</span> <span class="ot">TRUE</span>, <span class="dt">names.arg=</span>nf_valida_seq$NF)

<span class="co">#Validando</span>
nf_valida_seq &lt;-<span class="st"> </span>nf[<span class="kw">order</span>(nf[,<span class="dv">1</span>], nf[,<span class="dv">3</span>],nf[,<span class="dv">4</span>]) &amp;<span class="st"> </span>nf$CNPJ==<span class="st">&quot;49.740.886/0001-07&quot;</span>,] 

nf_valida_seq</code></pre></div>
<pre><code>##                 CNPJ UF       Data  NF Classificacao Valor
## 8 49.740.886/0001-07 MA 2016-09-08 555            SA   666
## 9 49.740.886/0001-07 MA 2016-09-09 557          &lt;NA&gt;  7777</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>((<span class="kw">diff</span>(nf_valida_seq$NF) &lt;=<span class="dv">0</span>) ==<span class="st"> </span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Visualizaçãoo Gráfica</span>
<span class="kw">barplot</span>(nf_valida_seq$NF, <span class="dt">horiz =</span> <span class="ot">TRUE</span>, <span class="dt">names.arg=</span>nf_valida_seq$NF)</code></pre></div>
<p><img src="Curso_Audit_DadosRmd-02_files/figure-html/unnamed-chunk-14-3.png" title="" alt="" width="960" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Dataframe com 3 colunas</span>
nf_valida_seq &lt;-<span class="st"> </span>nf[<span class="kw">order</span>(nf[,<span class="dv">1</span>], nf[,<span class="dv">3</span>],nf[,<span class="dv">4</span>]),] 
nf_valida_seq</code></pre></div>
<pre><code>##                  CNPJ UF       Data      NF Classificacao   Valor
## 3  03.117.734/0001-43 SP 2016-09-03    2000           MEI     444
## 5  06.062.510/0001-70 SP 2016-09-05     222          &lt;NA&gt;    4444
## 6  16.474.789/0001-52 GO 2016-09-06   33333          &lt;NA&gt;      55
## 1  21.704.783/0001-64 RJ 2016-09-01      90            ME   30000
## 2  21.704.783/0001-64 RJ 2016-09-02      91            ME   40000
## 10 21.704.783/0001-64 ES 2016-09-10      89           MEI 8888888
## 8  49.740.886/0001-07 MA 2016-09-08     555            SA     666
## 9  49.740.886/0001-07 MA 2016-09-09     557          &lt;NA&gt;    7777
## 4  76.313.316/0001-03 SP 2016-09-04     111           MEI       4
## 7  84.846.156/0001-88 GO 2016-09-07 4444444           MEI     667</code></pre>
</div>
</div>
</div>
<div id="resumo-do-data-frame" class="section level1">
<h1><span class="header-section-number">10</span> Resumo do Data Frame</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(nf)</code></pre></div>
<pre><code>##      CNPJ                UF                 Data                    
##  Length:10          Length:10          Min.   :2016-09-01 00:00:00  
##  Class :character   Class :character   1st Qu.:2016-09-03 06:00:00  
##  Mode  :character   Mode  :character   Median :2016-09-05 12:00:00  
##                                        Mean   :2016-09-05 12:00:00  
##                                        3rd Qu.:2016-09-07 18:00:00  
##                                        Max.   :2016-09-10 00:00:00  
##        NF          Classificacao          Valor        
##  Min.   :     89   Length:10          Min.   :      4  
##  1st Qu.:     96   Class :character   1st Qu.:    500  
##  Median :    388   Mode  :character   Median :   2556  
##  Mean   : 448149                      Mean   : 897294  
##  3rd Qu.:   1639                      3rd Qu.:  24444  
##  Max.   :4444444                      Max.   :8888888</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(nf$Valor)</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##       4     500    2556  897300   24440 8889000</code></pre>
</div>
<div id="aprofundando-nos-testes-de-possiveis-fraudes" class="section level1">
<h1><span class="header-section-number">11</span> Aprofundando nos Testes de Possíveis Fraudes</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Carrega arquivo de Impostos Pagos</span>
nf_recolhidas &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file=</span><span class="st">&quot;~/Documents/Recolhimento.csv&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;;&quot;</span>,<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>,<span class="dt">na.strings=</span><span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot; &quot;</span>) )

<span class="co">#Verificar se o registro dos impostos recolhidos a maior </span>
<span class="co"># Processa o campo Valor</span>
nf_recolhidas$Valor &lt;-<span class="st"> </span><span class="kw">trimws</span>(<span class="kw">gsub</span>(<span class="st">&quot;[R$.]&quot;</span>,<span class="st">&quot;&quot;</span>,nf_recolhidas$Valor))
nf_recolhidas$Valor &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;,&quot;</span>,<span class="st">&quot;.&quot;</span>, nf_recolhidas$Valor))
nf_recolhidas$Recolhimento &lt;-<span class="st"> </span><span class="kw">trimws</span>(<span class="kw">gsub</span>(<span class="st">&quot;[R$.]&quot;</span>,<span class="st">&quot;&quot;</span>,nf_recolhidas$Recolhimento))
nf_recolhidas$Recolhimento &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;,&quot;</span>,<span class="st">&quot;.&quot;</span>, nf_recolhidas$Recolhimento))


<span class="co">#Cria um Data Frame com limite de Auditoria </span>
nf_limite &lt;-<span class="st"> </span><span class="kw">aggregate</span>(Valor ~<span class="st"> </span>CNPJ, <span class="dt">data=</span>nf_recolhidas, function(x)<span class="dv">2</span>*<span class="kw">mean</span>(x))
<span class="kw">head</span>(nf_limite)</code></pre></div>
<pre><code>##                 CNPJ   Valor
## 1 03.117.734/0001-43     888
## 2 06.062.510/0001-70    8888
## 3 16.474.789/0001-52     110
## 4 21.704.783/0001-64 5972592
## 5 49.740.886/0001-07    8443
## 6 76.313.316/0001-03       8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Data frame unindo os DF das NF com informações sobre impostos recolhidos e o arquivo com os limites de auditoria</span>
impostos_recolhidos &lt;-<span class="st"> </span><span class="kw">merge</span>(nf_recolhidas, nf_limite, <span class="dt">by=</span><span class="st">&quot;CNPJ&quot;</span>)

<span class="kw">head</span>(impostos_recolhidos)</code></pre></div>
<pre><code>##                 CNPJ    NF Recolhimento Valor.x Data_Recolhimento Valor.y
## 1 03.117.734/0001-43  2000        79.92     444          17/09/16     888
## 2 06.062.510/0001-70   222       799.92    4444          19/09/16    8888
## 3 16.474.789/0001-52 33333         9.90      55              &lt;NA&gt;     110
## 4 21.704.783/0001-64    90      5400.00   30000          15/09/16 5972592
## 5 21.704.783/0001-64    91      7200.00   40000          16/09/16 5972592
## 6 21.704.783/0001-64    89   1599999.84 8888888          24/09/16 5972592</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Compara os Valores Informados com os Valores utilizados para Pgto de Impostos</span>
registro_audit &lt;-<span class="st"> </span><span class="kw">subset</span>(impostos_recolhidos, Valor.x &gt;<span class="st"> </span>Valor.y)

<span class="co">#Lista os registros candidatos a serem auditados em detalhe</span>
<span class="kw">print</span>(registro_audit)</code></pre></div>
<pre><code>##                 CNPJ NF Recolhimento Valor.x Data_Recolhimento Valor.y
## 6 21.704.783/0001-64 89      1600000 8888888          24/09/16 5972592</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##Indica o número de Registros candidatos a auditoria detalhada
<span class="kw">nrow</span>(registro_audit)</code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Escrevendo o data frame com os registros sob suspeita no disco no padrão CSV </span>
<span class="kw">write.csv2</span>(registro_audit,<span class="dt">file=</span><span class="st">&quot;~/Documents/Registros_Possiveis_Fraudes.csv&quot;</span>,<span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
